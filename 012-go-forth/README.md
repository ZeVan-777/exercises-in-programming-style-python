# Forth 风格

> “Forth是一种“人机一体”的编程语言。在程序员的意识中必须要有一台逻辑上的机器（可能是实际的芯片，也可能是虚拟机）。这台机器拥有两个堆栈（数据堆栈`stack`和返回堆栈`rstack`），一个词典（在Forth中的词`word`对应于高级语言的函数或者子程序，若干的词构成词典。）一个内部解释器和一个外部解释器。”

## 约束

1. 一个数据栈，所有操作均针对栈中数据
2. 一个数据堆，存储后续操作所需的数据。通过变量（命名标识符）关联查找。堆中数据需要入栈才可操作，完成后出栈回到堆。
3. 开发者抽象解决问题的**“过程”** —— 函数名对应一组指令

## 注解

> Forth 的核心概念是栈，操作数逐个入栈，操作符每次取栈顶的操作数进行计算，并将结果重新入栈或存放在内存堆中（不需要立即使用的结果）。除了栈，Forth 还支持过程的定义，以可操作栈中的数据。

为了满足 Forth 风格的约束（栈、堆、过程和名字），先定义栈`stack`、堆`heap`，并定义若干过程，分解问题为更小的步骤，如`read_file`、`remove_stop_words`、`frequencies`……**所有过程从栈顶获取数据，结束时将数据重新入栈**。

Forth 的堆支持**名字关联的数据块**分配 —— 变量，但需要程序员自行定义数据大小，在`Python`中简单使用字典模拟。如扫描数据文件中所有单词并依次入栈后，执行`remove_stop_words`过程。先读取停止词存入堆中，依次与栈顶单词比较，决定其出栈后去向。如果单词为停止词，则直接出栈并忽略；非停止词存入堆中`words`数据块，等待数据栈中单词处理全部处理完成后重新入栈。这个过程结束前，不再需要的堆中`words`数据块被清理。

主函数是程序的入口，首先将数据文件路径入栈，然后依次调用过程。**这些过程并不完全相互独立，因为每一个过程都依赖于前一过程完成后栈中数据的状态**。完成计数和排序后的栈中单词，即可以打印结果。

```python

# 循环计数 i 初始值
stack.append(0)
# （排序后）数据栈顶取25个数据 —— top25
while stack[-1] < 25 and len(stack) > 1:
    heap['i'] = stack.pop()
    (w, f) = stack.pop()
    print(w, ' - ', f)
    # 循环计数 i 1 +
    stack.append(heap['i']); stack.append(1)
    stack.append(stack.pop() + stack.pop())
```

这段代码体现了 Forth 语言的“不确定循环”风格，即循环持续到某条件成立。其中`len(stack) > 1`条件为应对小数值情况 —— 测试文件词数小于 25 个单词。
